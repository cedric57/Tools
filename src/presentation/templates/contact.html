{% extends "base.html" %}

{% block title %}{{ context.seo.title }}{% endblock %}
{% block description %}{{ context.seo.description }}{% endblock %}
{% block keywords %}{{ context.seo.keywords }}{% endblock %}
{% block canonical %}{{ context.seo.canonical_url }}{% endblock %}
{% block og_title %}{{ context.seo.og_title }}{% endblock %}
{% block og_description %}{{ context.seo.og_description }}{% endblock %}
{% block twitter_title %}{{ context.seo.og_title }}{% endblock %}
{% block twitter_description %}{{ context.seo.og_description }}{% endblock %}

{% block content %}
<!-- En-t√™te de page -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="h2 mb-1">üìß Contactez-nous</h1>
        <p class="text-muted mb-0">Une question, une suggestion d'outil, ou simplement un mot ? Nous sommes √† votre √©coute !</p>
    </div>
    <div class="badge bg-primary fs-6">
        <i class="bi bi-envelope me-1"></i>Contact
    </div>
</div>

{% if context.contact_success %}
<!-- Message de succ√®s -->
<div class="alert alert-success d-flex align-items-center" role="alert">
    <i class="bi bi-check-circle-fill me-3 fs-4"></i>
    <div class="w-100">
        <h4 class="alert-heading mb-3">Message envoy√© avec succ√®s !</h4>
        <p class="mb-3">Nous avons bien re√ßu votre message et nous vous r√©pondrons dans les plus brefs d√©lais.</p>

        <div class="card bg-light">
            <div class="card-body">
                <h6 class="card-title">R√©capitulatif :</h6>
                <div class="row">
                    <div class="col-md-6">
                        <p class="mb-1"><strong>Nom :</strong> {{ context.original_name }}</p>
                        <p class="mb-1"><strong>Email :</strong> {{ context.original_email }}</p>
                    </div>
                    <div class="col-md-6">
                        <p class="mb-1"><strong>Sujet :</strong> {{ context.original_subject }}</p>
                        {% if context.original_tool_suggestion %}
                        <p class="mb-1"><strong>Suggestion :</strong> {{ context.original_tool_suggestion }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-3">
            <a href="/contact" class="btn btn-primary">
                <i class="bi bi-envelope me-2"></i>Envoyer un autre message
            </a>
        </div>
    </div>
</div>

{% else %}
<!-- Formulaire de contact -->
<div class="row">
    <div class="col-lg-8">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-primary text-white">
                <h3 class="h5 mb-0">
                    <i class="bi bi-envelope me-2"></i>Envoyez-nous un message
                </h3>
            </div>
            <div class="card-body">
                <p class="text-muted mb-4">Nous appr√©cions vos retours et suggestions pour am√©liorer nos outils. N'h√©sitez pas √† nous contacter !</p>

                {% if context.contact_error %}
                <div class="alert alert-danger d-flex align-items-center" role="alert">
                    <i class="bi bi-exclamation-triangle me-2"></i>
                    <div>
                        <strong>Erreur :</strong> {{ context.contact_error }}
                    </div>
                </div>
                {% endif %}

                <form method="post" action="/contact" class="needs-validation" novalidate>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="name" class="form-label fw-semibold">Votre nom *</label>
                            <input type="text" class="form-control" id="name" name="name"
                                   value="{{ context.original_name or '' }}"
                                   placeholder="Votre nom complet" required>
                            <div class="form-text">Comment souhaitez-vous que nous vous appelions ?</div>
                        </div>

                        <div class="col-md-6">
                            <label for="email" class="form-label fw-semibold">Votre email *</label>
                            <input type="email" class="form-control" id="email" name="email"
                                   value="{{ context.original_email or '' }}"
                                   placeholder="votre@email.com" required>
                            <div class="form-text">Nous ne partagerons jamais votre email avec des tiers.</div>
                        </div>

                        <div class="col-12">
                            <label for="subject" class="form-label fw-semibold">Sujet du message *</label>
                            <select class="form-select" id="subject" name="subject" required>
                                <option value="">Choisissez un sujet...</option>
                                <option value="Suggestion d'outil" {% if context.original_subject == 'Suggestion d\'outil' %}selected{% endif %}>üí° Suggestion d'outil</option>
                                <option value="Probl√®me technique" {% if context.original_subject == 'Probl√®me technique' %}selected{% endif %}>üêõ Probl√®me technique</option>
                                <option value="Question g√©n√©rale" {% if context.original_subject == 'Question g√©n√©rale' %}selected{% endif %}>‚ùì Question g√©n√©rale</option>
                                <option value="Collaboration" {% if context.original_subject == 'Collaboration' %}selected{% endif %}>ü§ù Collaboration</option>
                                <option value="Autre" {% if context.original_subject == 'Autre' %}selected{% endif %}>üìù Autre</option>
                            </select>
                            <div class="form-text">Choisissez la cat√©gorie qui correspond le mieux √† votre message.</div>
                        </div>

                        <div class="col-12" id="tool-suggestion-group"
                             style="display: {% if context.original_subject == 'Suggestion d\'outil' or context.original_tool_suggestion %}block{% else %}none{% endif %};">
                            <label for="tool_suggestion" class="form-label fw-semibold">Quel outil souhaiteriez-vous voir ajout√© ?</label>
                            <input type="text" class="form-control" id="tool_suggestion" name="tool_suggestion"
                                   value="{{ context.original_tool_suggestion or '' }}"
                                   placeholder="Ex: Convertisseur JSON, G√©n√©rateur de QR Code, etc.">
                            <div class="form-text">D√©crivez bri√®vement l'outil que vous aimeriez utiliser.</div>
                        </div>

                        <div class="col-12">
                            <label for="message" class="form-label fw-semibold">Votre message *</label>
                            <textarea class="form-control" id="message" name="message"
                                      placeholder="D√©crivez en d√©tail votre question, suggestion ou probl√®me..."
                                      rows="5" required>{{ context.original_message or '' }}</textarea>
                            <div class="form-text">Soyez aussi pr√©cis que possible pour que nous puissions vous aider au mieux.</div>
                        </div>

                        <div class="col-12">
                            <div class="d-grid gap-2 d-md-flex justify-content-md-start">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="bi bi-send me-2"></i>Envoyer le message
                                </button>
                                <button type="reset" class="btn btn-outline-secondary btn-lg">
                                    <i class="bi bi-arrow-clockwise me-2"></i>Effacer
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <!-- Informations de contact alternatives -->
        <div class="card border-0 shadow-sm mb-4">
            <div class="card-header bg-light">
                <h4 class="h6 mb-0">
                    <i class="bi bi-info-circle me-2"></i>Autres moyens de nous contacter
                </h4>
            </div>
            <div class="card-body">
                <div class="d-grid gap-3">
                    <div class="d-flex align-items-start">
                        <i class="bi bi-lightbulb text-warning me-3 fs-5"></i>
                        <div>
                            <h6 class="mb-1">Suggestions d'outils</h6>
                            <p class="text-muted small mb-0">Vous avez une id√©e d'outil qui pourrait √™tre utile ?</p>
                        </div>
                    </div>

                    <div class="d-flex align-items-start">
                        <i class="bi bi-bug-fill text-danger me-3 fs-5"></i>
                        <div>
                            <h6 class="mb-1">Signaler un probl√®me</h6>
                            <p class="text-muted small mb-0">Vous avez rencontr√© un bug ou un dysfonctionnement ?</p>
                        </div>
                    </div>

                    <div class="d-flex align-items-start">
                        <i class="bi bi-star text-primary me-3 fs-5"></i>
                        <div>
                            <h6 class="mb-1">Am√©liorations</h6>
                            <p class="text-muted small mb-0">Vous avez des id√©es pour am√©liorer nos outils existants ?</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- FAQ de contact -->
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-light">
                <h4 class="h6 mb-0">
                    <i class="bi bi-question-circle me-2"></i>Questions fr√©quentes
                </h4>
            </div>
            <div class="card-body">
                <div class="accordion accordion-flush" id="contactFAQ">
                    <div class="accordion-item">
                        <h5 class="accordion-header">
                            <button class="accordion-button collapsed py-2" type="button" data-bs-toggle="collapse" data-bs-target="#faqContact1">
                                ‚è±Ô∏è D√©lai de r√©ponse
                            </button>
                        </h5>
                        <div id="faqContact1" class="accordion-collapse collapse" data-bs-parent="#contactFAQ">
                            <div class="accordion-body small">
                                Nous nous effor√ßons de r√©pondre √† tous les messages dans un d√©lai de 24 √† 48 heures.
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <h5 class="accordion-header">
                            <button class="accordion-button collapsed py-2" type="button" data-bs-toggle="collapse" data-bs-target="#faqContact2">
                                üîß Proposer un outil
                            </button>
                        </h5>
                        <div id="faqContact2" class="accordion-collapse collapse" data-bs-parent="#contactFAQ">
                            <div class="accordion-body small">
                                Absolument ! Nous adorons recevoir des suggestions d'outils. D√©crivez-nous votre id√©e et nous l'√©tudierons.
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <h5 class="accordion-header">
                            <button class="accordion-button collapsed py-2" type="button" data-bs-toggle="collapse" data-bs-target="#faqContact3">
                                üêõ Signaler un bug
                            </button>
                        </h5>
                        <div id="faqContact3" class="accordion-collapse collapse" data-bs-parent="#contactFAQ">
                            <div class="accordion-body small">
                                Utilisez le formulaire en s√©lectionnant "Probl√®me technique". D√©crivez le probl√®me en d√©tail, y compris les √©tapes pour le reproduire.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<script>
// Afficher/masquer le champ de suggestion d'outil selon le sujet
document.addEventListener('DOMContentLoaded', function() {
    const subjectSelect = document.getElementById('subject');
    const toolSuggestionGroup = document.getElementById('tool-suggestion-group');

    if (subjectSelect && toolSuggestionGroup) {
        subjectSelect.addEventListener('change', function() {
            if (this.value === 'Suggestion d\'outil') {
                toolSuggestionGroup.style.display = 'block';
            } else {
                toolSuggestionGroup.style.display = 'none';
            }
        });
    }

    // Validation Bootstrap
    const forms = document.querySelectorAll('.needs-validation');
    for (const form of forms) {
        form.addEventListener('submit', function(event) {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }
            form.classList.add('was-validated');
        }, false);
    }

    // Focus sur le premier champ
    const firstInput = document.querySelector('input[type="text"], input[type="email"], select');
    if (firstInput) {
        firstInput.focus();
    }
});
</script>
{% endblock %}
