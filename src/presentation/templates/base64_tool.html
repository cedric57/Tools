{% extends "base.html" %}

{% block title %}{{ context.seo.title }}{% endblock %}
{% block description %}{{ context.seo.description }}{% endblock %}
{% block keywords %}{{ context.seo.keywords }}{% endblock %}
{% block canonical %}{{ context.seo.canonical_url }}{% endblock %}
{% block og_title %}{{ context.seo.og_title }}{% endblock %}
{% block og_description %}{{ context.seo.og_description }}{% endblock %}
{% block twitter_title %}{{ context.seo.og_title }}{% endblock %}
{% block twitter_description %}{{ context.seo.og_description }}{% endblock %}

{% block content %}
{# D√©finir des variables pour simplifier le template #}
{% set current_charset = context.charset %}
{% set current_path = request.url.path %}

<!-- En-t√™te de page -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="h2 mb-1">{{ context.seo.og_title }}</h1>
        <p class="text-muted mb-0">{{ context.seo.description }}</p>
    </div>
    <div class="badge bg-primary fs-6">
        <i class="bi bi-file-binary me-1"></i>Base64
    </div>
</div>

<!-- Indicateur de page active -->
<div class="alert alert-info d-flex align-items-center mb-4">
    <i class="bi bi-info-circle me-2"></i>
    <div>
        <strong>Outil actif :</strong>
        {% if current_path == '/encode' %}
            Encodeur Base64
        {% elif current_path == '/decode' %}
            D√©codeur Base64
        {% else %}
            Suite d'outils Base64
        {% endif %}
    </div>
</div>

<!-- Section unique selon la page -->
{% if current_path == '/' %}
    <!-- Page d'accueil avec les deux outils -->
    <div class="row g-4">
        <!-- Carte D√©codage -->
        <div class="col-xl-6">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-primary text-white">
                    <h3 class="h5 mb-0">
                        <i class="bi bi-arrow-down-circle me-2"></i>D√©coder le Base64
                    </h3>
                </div>
                <div class="card-body">
                    <p class="text-muted mb-3">Convertir une cha√Æne Base64 en texte lisible</p>

                    <form method="post" action="/decode">
                        <div class="mb-3">
                            <label for="base64_text" class="form-label fw-semibold">Texte Base64 √† d√©coder :</label>
                            <textarea class="form-control font-monospace" id="base64_text" name="base64_text"
                                      rows="5" placeholder="Pastez votre cha√Æne Base64 ici (une par ligne pour le d√©codage multiple)"
                                      required>{{ context.original_base64 }}</textarea>
                            <div class="form-text">Collez votre texte encod√© en Base64 pour le d√©coder. Une ligne = une entr√©e Base64.</div>
                        </div>

                        <!-- Case √† cocher pour le d√©codage ligne par ligne -->
                        <div class="mb-3">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="decode_line_by_line"
                                       name="decode_line_by_line" value="true"
                                       {% if context.decode_line_by_line %}checked{% endif %}>
                                <label class="form-check-label fw-semibold" for="decode_line_by_line">
                                    <i class="bi bi-file-text me-1"></i>D√©coder chaque ligne s√©par√©ment
                                </label>
                            </div>
                            <div class="form-text">Utile pour les entr√©es multiples (une cha√Æne Base64 par ligne)</div>
                        </div>

                        <div class="mb-3">
                            <label for="charset_decode" class="form-label fw-semibold">Encodage des caract√®res :</label>
                            <select class="form-select" id="charset_decode" name="character_set">
                                {% for category in context.encoding_categories %}
                                    {% if category.name == "AUTO-DETECT" %}
                                        {% for encoding_value, encoding_label in category.encodings %}
                                            <option value="{{ encoding_value }}"
                                                {% if current_charset == encoding_value %}selected{% endif %}>
                                                {{ encoding_label }}
                                            </option>
                                        {% endfor %}
                                    {% else %}
                                        <optgroup label="{{ category.name }}">
                                            {% for encoding_value, encoding_label in category.encodings %}
                                                <option value="{{ encoding_value }}"
                                                    {% if current_charset == encoding_value %}selected{% endif %}>
                                                    {{ encoding_label }}
                                                </option>
                                            {% endfor %}
                                        </optgroup>
                                    {% endif %}
                                {% endfor %}
                            </select>
                        </div>

                        <button type="submit" class="btn btn-primary w-100">
                            <i class="bi bi-arrow-down-circle me-2"></i>D√©coder
                        </button>
                    </form>

            <div class="tool-actions">
                <button type="button" class="btn-clear" onclick="clearAllFields()" aria-label="Effacer tous les champs">
                    üßπ Effacer tout
                </button>
                <small>Raccourci: Ctrl + K</small>
            </div>

                    {% if context.decoded_result %}
                    <div class="mt-4">
                        <h5 class="text-success">
                            <i class="bi bi-check-circle me-2"></i>R√©sultat d√©cod√© :
                        </h5>
                        <div class="card bg-light">
                            <div class="card-body">
                                <pre class="mb-0"><code>{{ context.decoded_result }}</code></pre>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    {% if context.decode_error %}
                    <div class="alert alert-danger mt-3" role="alert">
                        <i class="bi bi-exclamation-triangle me-2"></i>{{ context.decode_error }}
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Carte Encodage -->
        <div class="col-xl-6">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-success text-white">
                    <h3 class="h5 mb-0">
                        <i class="bi bi-arrow-up-circle me-2"></i>Encoder en Base64
                    </h3>
                </div>
                <div class="card-body">
                    <p class="text-muted mb-3">Convertir du texte en format Base64</p>

                    <form method="post" action="/encode">
                        <div class="mb-3">
                            <label for="plain_text" class="form-label fw-semibold">Texte √† encoder :</label>
                            <textarea class="form-control font-monospace" id="plain_text" name="plain_text"
                                      rows="5" placeholder="Entrez le texte √† encoder en Base64"
                                      required>{{ context.original_text }}</textarea>
                            <div class="form-text">Saisissez le texte que vous souhaitez convertir en Base64</div>
                        </div>

                        <div class="mb-3">
                            <label for="charset_encode" class="form-label fw-semibold">Encodage des caract√®res :</label>
                            <select class="form-select" id="charset_encode" name="character_set">
                                {% for category in context.encoding_categories %}
                                    {% if category.name == "AUTO-DETECT" %}
                                        {% for encoding_value, encoding_label in category.encodings %}
                                            <option value="{{ encoding_value }}"
                                                {% if current_charset == encoding_value %}selected{% endif %}>
                                                {{ encoding_label }}
                                            </option>
                                        {% endfor %}
                                    {% else %}
                                        <optgroup label="{{ category.name }}">
                                            {% for encoding_value, encoding_label in category.encodings %}
                                                <option value="{{ encoding_value }}"
                                                    {% if current_charset == encoding_value %}selected{% endif %}>
                                                    {{ encoding_label }}
                                                </option>
                                            {% endfor %}
                                        </optgroup>
                                    {% endif %}
                                {% endfor %}
                            </select>
                        </div>

                        <button type="submit" class="btn btn-success w-100">
                            <i class="bi bi-arrow-up-circle me-2"></i>Encoder
                        </button>
                    </form>

            <div class="tool-actions">
                <button type="button" class="btn-clear" onclick="clearAllFields()" aria-label="Effacer tous les champs">
                    üßπ Effacer tout
                </button>
                <small>Raccourci: Ctrl + K</small>
            </div>

                    {% if context.encoded_result %}
                    <div class="mt-4">
                        <h5 class="text-success">
                            <i class="bi bi-check-circle me-2"></i>R√©sultat encod√© :
                        </h5>
                        <div class="card bg-light">
                            <div class="card-body position-relative">
                                <pre class="mb-0"><code>{{ context.encoded_result }}</code></pre>
                                <button class="btn btn-sm btn-outline-primary position-absolute top-0 end-0 mt-2 me-2"
                                        onclick="copyToClipboard('{{ context.encoded_result }}', this)">
                                    <i class="bi bi-clipboard"></i> Copier
                                </button>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    {% if context.encode_error %}
                    <div class="alert alert-danger mt-3" role="alert">
                        <i class="bi bi-exclamation-triangle me-2"></i>{{ context.encode_error }}
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

{% elif current_path == '/encode' %}
    <!-- Page d'encodage seule -->
    <div class="card border-0 shadow-sm">
        <div class="card-header bg-success text-white">
            <h2 class="h4 mb-0">
                <i class="bi bi-arrow-up-circle me-2"></i>Encoder en Base64
            </h2>
        </div>
        <div class="card-body">
            <p class="lead">Convertir du texte en format Base64 pour l'int√©gration dans des URLs, emails, ou donn√©es texte.</p>

            <form method="post" action="/encode">
                <div class="row">
                    <div class="col-lg-8">
                        <div class="mb-3">
                            <label for="plain_text" class="form-label fw-semibold">Texte √† encoder :</label>
                            <textarea class="form-control font-monospace" id="plain_text" name="plain_text"
                                      rows="6" placeholder="Entrez le texte √† encoder en Base64..."
                                      required>{{ context.original_text }}</textarea>
                            <div class="form-text">Saisissez le texte que vous souhaitez convertir en Base64. Supporte tous les caract√®res UTF-8.</div>
                        </div>
                    </div>

                    <div class="col-lg-4">
                        <div class="mb-3">
                            <label for="charset_encode" class="form-label fw-semibold">Encodage des caract√®res :</label>
                            <select class="form-select" id="charset_encode" name="character_set">
                                {% for category in context.encoding_categories %}
                                    {% if category.name == "AUTO-DETECT" %}
                                        {% for encoding_value, encoding_label in category.encodings %}
                                            <option value="{{ encoding_value }}"
                                                {% if current_charset == encoding_value %}selected{% endif %}>
                                                {{ encoding_label }}
                                            </option>
                                        {% endfor %}
                                    {% else %}
                                        <optgroup label="{{ category.name }}">
                                            {% for encoding_value, encoding_label in category.encodings %}
                                                <option value="{{ encoding_value }}"
                                                    {% if current_charset == encoding_value %}selected{% endif %}>
                                                    {{ encoding_label }}
                                                </option>
                                            {% endfor %}
                                        </optgroup>
                                    {% endif %}
                                {% endfor %}
                            </select>
                        </div>

                        <button type="submit" class="btn btn-success w-100 btn-lg">
                            <i class="bi bi-arrow-up-circle me-2"></i>Encoder en Base64
                        </button>
                    </div>
                </div>
            </form>

        <div class="tool-actions">
            <button type="button" class="btn-clear" onclick="clearAllFields()" aria-label="Effacer tous les champs">
                üßπ Effacer tout
            </button>
            <small>Raccourci: Ctrl + K</small>
        </div>

            {% if context.encoded_result %}
            <div class="mt-4">
                <h5 class="text-success">
                    <i class="bi bi-check-circle me-2"></i>R√©sultat encod√© :
                </h5>
                <div class="card bg-light">
                    <div class="card-body position-relative">
                        <pre class="mb-0"><code>{{ context.encoded_result }}</code></pre>
                        <button class="btn btn-sm btn-outline-primary position-absolute top-0 end-0 mt-2 me-2"
                                onclick="copyToClipboard('{{ context.encoded_result }}', this)">
                            <i class="bi bi-clipboard"></i> Copier
                        </button>
                    </div>
                </div>
            </div>
            {% endif %}

            {% if context.encode_error %}
            <div class="alert alert-danger mt-3" role="alert">
                <i class="bi bi-exclamation-triangle me-2"></i>
                <strong>Erreur :</strong> {{ context.encode_error }}
            </div>
            {% endif %}
        </div>
    </div>

{% elif current_path == '/decode' %}
    <!-- Page de d√©codage seule -->
    <div class="card border-0 shadow-sm">
        <div class="card-header bg-primary text-white">
            <h2 class="h4 mb-0">
                <i class="bi bi-arrow-down-circle me-2"></i>D√©coder le Base64
            </h2>
        </div>
        <div class="card-body">
            <p class="lead">Convertir une cha√Æne Base64 en texte lisible original. Support du d√©codage multiple ligne par ligne.</p>

            <form method="post" action="/decode">
                <div class="row">
                    <div class="col-lg-8">
                        <div class="mb-3">
                            <label for="base64_text" class="form-label fw-semibold">Texte Base64 √† d√©coder :</label>
                            <textarea class="form-control font-monospace" id="base64_text" name="base64_text"
                                      rows="6" placeholder="Pastez votre cha√Æne Base64 ici (une par ligne pour le d√©codage multiple)..."
                                      required>{{ context.original_base64 }}</textarea>
                            <div class="form-text">Collez votre texte encod√© en Base64 pour le d√©coder. Une ligne = une entr√©e Base64.</div>
                        </div>
                    </div>

                    <div class="col-lg-4">
                        <!-- Case √† cocher pour le d√©codage ligne par ligne -->
                        <div class="mb-3">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="decode_line_by_line"
                                       name="decode_line_by_line" value="true"
                                       {% if context.decode_line_by_line %}checked{% endif %}>
                                <label class="form-check-label fw-semibold" for="decode_line_by_line">
                                    <i class="bi bi-file-text me-1"></i>D√©coder chaque ligne s√©par√©ment
                                </label>
                            </div>
                            <div class="form-text">Active le d√©codage individuel de chaque ligne.</div>
                        </div>

                        <div class="mb-3">
                            <label for="charset_decode" class="form-label fw-semibold">Encodage des caract√®res :</label>
                            <select class="form-select" id="charset_decode" name="character_set">
                                {% for category in context.encoding_categories %}
                                    {% if category.name == "AUTO-DETECT" %}
                                        {% for encoding_value, encoding_label in category.encodings %}
                                            <option value="{{ encoding_value }}"
                                                {% if current_charset == encoding_value %}selected{% endif %}>
                                                {{ encoding_label }}
                                            </option>
                                        {% endfor %}
                                    {% else %}
                                        <optgroup label="{{ category.name }}">
                                            {% for encoding_value, encoding_label in category.encodings %}
                                                <option value="{{ encoding_value }}"
                                                    {% if current_charset == encoding_value %}selected{% endif %}>
                                                    {{ encoding_label }}
                                                </option>
                                            {% endfor %}
                                        </optgroup>
                                    {% endif %}
                                {% endfor %}
                            </select>
                        </div>

                        <button type="submit" class="btn btn-primary w-100 btn-lg">
                            <i class="bi bi-arrow-down-circle me-2"></i>D√©coder le Base64
                        </button>
                    </div>
                </div>
            </form>

        <div class="tool-actions">
            <button type="button" class="btn-clear" onclick="clearAllFields()" aria-label="Effacer tous les champs">
                üßπ Effacer tout
            </button>
            <small>Raccourci: Ctrl + K</small>
        </div>

            {% if context.decoded_result %}
            <div class="mt-4">
                <h5 class="text-success">
                    <i class="bi bi-check-circle me-2"></i>R√©sultat d√©cod√© :
                </h5>
                <div class="card bg-light">
                    <div class="card-body position-relative">
                        <pre class="mb-0"><code>{{ context.decoded_result }}</code></pre>
                        <button class="btn btn-sm btn-outline-primary position-absolute top-0 end-0 mt-2 me-2"
                                onclick="copyToClipboard('{{ context.decoded_result }}', this)">
                            <i class="bi bi-clipboard"></i> Copier
                        </button>
                    </div>
                </div>
            </div>
            {% endif %}

            {% if context.decode_error %}
            <div class="alert alert-danger mt-3" role="alert">
                <i class="bi bi-exclamation-triangle me-2"></i>
                <strong>Erreur :</strong> {{ context.decode_error }}
            </div>
            {% endif %}
        </div>
    </div>
{% endif %}

<!-- Section FAQ pour le SEO -->
<div class="card border-0 shadow-sm mt-4">
    <div class="card-header bg-light">
        <h3 class="h5 mb-0">
            <i class="bi bi-question-circle me-2"></i>FAQ Base64 - Encodages Support√©s
        </h3>
    </div>
    <div class="card-body">
        <div class="accordion" id="faqAccordion">
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
                        Qu'est-ce que l'auto-d√©tection d'encodage ?
                    </button>
                </h2>
                <div id="faq1" class="accordion-collapse collapse show" data-bs-parent="#faqAccordion">
                    <div class="accordion-body">
                        L'auto-d√©tection analyse automatiquement votre texte Base64 pour identifier l'encodage original utilis√©. Cette fonctionnalit√© utilise des algorithmes avanc√©s pour d√©terminer l'encodage le plus probable avec un niveau de confiance √©lev√©.
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                        Quels encodages sont support√©s ?
                    </button>
                </h2>
                <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                    <div class="accordion-body">
                        Notre outil supporte plus de 30 encodages diff√©rents incluant UTF-8, ASCII, Latin-1, Windows-1252, UTF-16, ainsi que des encodages sp√©cifiques aux langues comme le Japonais (Shift JIS, EUC-JP), le Chinois (GB2312, Big5), le Russe (KOI8-R), et bien d'autres.
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq3">
                        Quand utiliser l'auto-d√©tection ?
                    </button>
                </h2>
                <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                    <div class="accordion-body">
                        Utilisez l'auto-d√©tection quand vous ne connaissez pas l'encodage original du texte Base64. C'est particuli√®rement utile pour d√©coder des donn√©es provenant de sources inconnues ou de syst√®mes h√©rit√©s.
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
