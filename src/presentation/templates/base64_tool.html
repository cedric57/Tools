{% extends "base.html" %}

{% block title %}{{ context.seo.title }}{% endblock %}
{% block description %}{{ context.seo.description }}{% endblock %}
{% block keywords %}{{ context.seo.keywords }}{% endblock %}
{% block canonical %}{{ context.seo.canonical_url }}{% endblock %}
{% block og_title %}{{ context.seo.og_title }}{% endblock %}
{% block og_description %}{{ context.seo.og_description }}{% endblock %}
{% block twitter_title %}{{ context.seo.og_title }}{% endblock %}
{% block twitter_description %}{{ context.seo.og_description }}{% endblock %}

{% block content %}
{# D√©finir des variables pour simplifier le template #}
{% set current_charset = context.charset %}
{% set current_path = request.url.path %}

<div class="content-header">
    <h1 id="main-heading">{{ context.seo.og_title }}</h1>
    <p class="subtitle">{{ context.seo.description }}</p>
</div>

<!-- Indicateur visuel de l'outil actif -->
<div class="tool-indicator">
    <span class="tool-badge">Base64</span>
    <span class="tool-action">
        {% if current_path == '/encode' %}
            Encoder
        {% elif current_path == '/decode' %}
            D√©coder
        {% else %}
            Outils
        {% endif %}
    </span>
</div>

<!-- Section unique selon la page -->
{% if current_path == '/' %}
    <!-- Page d'accueil avec les deux outils -->
    <div class="tools-grid">
        <section aria-labelledby="decode-heading" class="tool-card">
            <div class="card-header">
                <h2 id="decode-heading">üî§ D√©coder le Base64</h2>
                <p>Convertir une cha√Æne Base64 en texte lisible</p>
            </div>
            <form method="post" action="/decode" role="form">
                <label for="base64_text">Texte Base64 √† d√©coder :</label>
                <textarea id="base64_text" name="base64_text"
                          aria-describedby="decode-help"
                          placeholder="Pastez votre cha√Æne Base64 ici"
                          required>{{ context.original_base64 }}</textarea>
                <small id="decode-help">Collez votre texte encod√© en Base64 pour le d√©coder</small>

                <div class="checkbox-group">
                    <input type="checkbox" id="decode_line_by_line" name="decode_line_by_line"
                           value="true" {% if context.decode_line_by_line %}checked{% endif %}>
                    <label for="decode_line_by_line" class="checkbox-label">
                        üìÑ D√©coder chaque ligne s√©par√©ment
                    </label>
                    <small class="checkbox-help">
                        Utile pour les entr√©es multiples (une cha√Æne Base64 par ligne)
                    </small>
                </div>

                <label for="charset_decode">Encodage des caract√®res :</label>
                <select id="charset_decode" name="character_set" class="encoding-select">
                    {% for category in context.encoding_categories %}
                        {% if category.name == "AUTO-DETECT" %}
                            {% for encoding_value, encoding_label in category.encodings %}
                                <option value="{{ encoding_value }}"
                                    {% if current_charset == encoding_value %}selected{% endif %}>
                                    {{ encoding_label }}
                                </option>
                            {% endfor %}
                        {% else %}
                            <optgroup label="{{ category.name }}">
                                {% for encoding_value, encoding_label in category.encodings %}
                                    <option value="{{ encoding_value }}"
                                        {% if current_charset == encoding_value %}selected{% endif %}>
                                        {{ encoding_label }}
                                    </option>
                                {% endfor %}
                            </optgroup>
                        {% endif %}
                    {% endfor %}
                </select>

                <button type="submit" aria-label="D√©coder le texte Base64">D√©coder</button>
            </form>

            <div class="tool-actions">
                <button type="button" class="btn-clear" onclick="clearAllFields()" aria-label="Effacer tous les champs">
                    üßπ Effacer tout
                </button>
                <small>Raccourci: Ctrl + K</small>
            </div>

            {% if context.decoded_result %}
            <div class="result" role="status">
                <h3>R√©sultat d√©cod√© :</h3>
                <pre><code>{{ context.decoded_result }}</code></pre>
            </div>
            {% endif %}

            {% if context.decode_error %}
            <div class="error" role="alert">
                {{ context.decode_error }}
            </div>
            {% endif %}
        </section>

        <section aria-labelledby="encode-heading" class="tool-card">
            <div class="card-header">
                <h2 id="encode-heading">üìù Encoder en Base64</h2>
                <p>Convertir du texte en format Base64</p>
            </div>
            <form method="post" action="/encode" role="form">
                <label for="plain_text">Texte √† encoder :</label>
                <textarea id="plain_text" name="plain_text"
                          aria-describedby="encode-help"
                          placeholder="Entrez le texte √† encoder en Base64"
                          required>{{ context.original_text }}</textarea>
                <small id="encode-help">Saisissez le texte que vous souhaitez convertir en Base64</small>

                <label for="charset_encode">Encodage des caract√®res :</label>
                <select id="charset_encode" name="character_set" class="encoding-select">
                    {% for category in context.encoding_categories %}
                        {% if category.name == "AUTO-DETECT" %}
                            {% for encoding_value, encoding_label in category.encodings %}
                                <option value="{{ encoding_value }}"
                                    {% if current_charset == encoding_value %}selected{% endif %}>
                                    {{ encoding_label }}
                                </option>
                            {% endfor %}
                        {% else %}
                            <optgroup label="{{ category.name }}">
                                {% for encoding_value, encoding_label in category.encodings %}
                                    <option value="{{ encoding_value }}"
                                        {% if current_charset == encoding_value %}selected{% endif %}>
                                        {{ encoding_label }}
                                    </option>
                                {% endfor %}
                            </optgroup>
                        {% endif %}
                    {% endfor %}
                </select>

                <button type="submit" aria-label="Encoder le texte en Base64">Encoder</button>
            </form>

            <div class="tool-actions">
                <button type="button" class="btn-clear" onclick="clearAllFields()" aria-label="Effacer tous les champs">
                    üßπ Effacer tout
                </button>
                <small>Raccourci: Ctrl + K</small>
            </div>

            {% if context.encoded_result %}
            <div class="result" role="status">
                <h3>R√©sultat encod√© :</h3>
                <pre><code>{{ context.encoded_result }}</code></pre>
            </div>
            {% endif %}

            {% if context.encode_error %}
            <div class="error" role="alert">
                {{ context.encode_error }}
            </div>
            {% endif %}
        </section>
    </div>

{% elif current_path == '/encode' %}
    <!-- Page d'encodage seule -->
    <section aria-labelledby="encode-heading" class="tool-single">
        <div class="tool-header">
            <h2 id="encode-heading">üìù Encoder en Base64</h2>
            <p>Convertir du texte en format Base64 pour l'int√©gration dans des URLs, emails, ou donn√©es texte.</p>
        </div>

        <form method="post" action="/encode" role="form" class="single-form">
            <div class="form-group">
                <label for="plain_text">Texte √† encoder :</label>
                <textarea id="plain_text" name="plain_text"
                          aria-describedby="encode-help"
                          placeholder="Entrez le texte √† encoder en Base64..."
                          required>{{ context.original_text }}</textarea>
                <small id="encode-help">Saisissez le texte que vous souhaitez convertir en Base64. Supporte tous les caract√®res UTF-8.</small>
            </div>

            <div class="form-group">
                <label for="charset_encode">Encodage des caract√®res :</label>
                <select id="charset_encode" name="character_set" class="encoding-select">
                    {% for category in context.encoding_categories %}
                        {% if category.name == "AUTO-DETECT" %}
                            {% for encoding_value, encoding_label in category.encodings %}
                                <option value="{{ encoding_value }}"
                                    {% if current_charset == encoding_value %}selected{% endif %}>
                                    {{ encoding_label }}
                                </option>
                            {% endfor %}
                        {% else %}
                            <optgroup label="{{ category.name }}">
                                {% for encoding_value, encoding_label in category.encodings %}
                                    <option value="{{ encoding_value }}"
                                        {% if current_charset == encoding_value %}selected{% endif %}>
                                        {{ encoding_label }}
                                    </option>
                                {% endfor %}
                            </optgroup>
                        {% endif %}
                    {% endfor %}
                </select>
            </div>

            <button type="submit" class="btn-primary" aria-label="Encoder le texte en Base64">
                üî§ Encoder en Base64
            </button>
        </form>

        <div class="tool-actions">
            <button type="button" class="btn-clear" onclick="clearAllFields()" aria-label="Effacer tous les champs">
                üßπ Effacer tout
            </button>
            <small>Raccourci: Ctrl + K</small>
        </div>

        {% if context.encoded_result %}
        <div class="result" role="status">
            <h3>R√©sultat encod√© :</h3>
            <div class="result-content">
                <pre><code>{{ context.encoded_result }}</code></pre>
                <button class="btn-copy" onclick="copyToClipboard({{ context.encoded_result | tojson }}, this)"
                        aria-label="Copier le r√©sultat">
                    üìã Copier
                </button>
            </div>
        </div>
        {% endif %}

        {% if context.encode_error %}
        <div class="error" role="alert">
            <strong>Erreur :</strong> {{ context.encode_error }}
        </div>
        {% endif %}
    </section>

{% elif current_path == '/decode' %}
    <!-- Page de d√©codage seule -->
    <section aria-labelledby="decode-heading" class="tool-single">
        <div class="tool-header">
            <h2 id="decode-heading">üî§ D√©coder le Base64</h2>
            <p>Convertir une cha√Æne Base64 en texte lisible original.</p>
        </div>

        <form method="post" action="/decode" role="form" class="single-form">
            <div class="form-group">
                <label for="base64_text">Texte Base64 √† d√©coder :</label>
                <textarea id="base64_text" name="base64_text"
                          aria-describedby="decode-help"
                          placeholder="Pastez votre cha√Æne Base64 ici..."
                          required>{{ context.original_base64 }}</textarea>
                <small id="decode-help">Collez votre texte encod√© en Base64 pour le d√©coder. Doit √™tre un Base64 valide.</small>
            </div>

            <div class="form-group checkbox-group">
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="decode_line_by_line" name="decode_line_by_line"
                           value="true" {% if context.decode_line_by_line %}checked{% endif %}
                           aria-describedby="line-by-line-help">
                    <label for="decode_line_by_line" class="checkbox-label">
                        üìÑ D√©coder chaque ligne s√©par√©ment
                    </label>
                </div>
                <small id="line-by-line-help" class="checkbox-help">
                    Active le d√©codage individuel de chaque ligne. Parfait pour les listes de tokens, cl√©s, ou donn√©es multiples.
                </small>
            </div>

            <div class="form-group">
                <label for="charset_decode">Encodage des caract√®res :</label>
                <select id="charset_decode" name="character_set" class="encoding-select">
                    {% for category in context.encoding_categories %}
                        {% if category.name == "AUTO-DETECT" %}
                            {% for encoding_value, encoding_label in category.encodings %}
                                <option value="{{ encoding_value }}"
                                    {% if current_charset == encoding_value %}selected{% endif %}>
                                    {{ encoding_label }}
                                </option>
                            {% endfor %}
                        {% else %}
                            <optgroup label="{{ category.name }}">
                                {% for encoding_value, encoding_label in category.encodings %}
                                    <option value="{{ encoding_value }}"
                                        {% if current_charset == encoding_value %}selected{% endif %}>
                                        {{ encoding_label }}
                                    </option>
                                {% endfor %}
                            </optgroup>
                        {% endif %}
                    {% endfor %}
                </select>
            </div>

            <button type="submit" class="btn-primary" aria-label="D√©coder le texte Base64">
                üìù D√©coder le Base64
            </button>
        </form>

        <div class="tool-actions">
            <button type="button" class="btn-clear" onclick="clearAllFields()" aria-label="Effacer tous les champs">
                üßπ Effacer tout
            </button>
            <small>Raccourci: Ctrl + K</small>
        </div>

        {% if context.decoded_result %}
        <div class="result" role="status">
            <h3>R√©sultat d√©cod√© :</h3>
            <div class="result-content">
                <pre><code>{{ context.decoded_result }}</code></pre>
                <button class="btn-copy" onclick="copyToClipboard({{ context.decoded_result | tojson }}, this)"
                        aria-label="Copier le r√©sultat">
                    üìã Copier
                </button>
            </div>
        </div>
        {% endif %}

        {% if context.decode_error %}
        <div class="error" role="alert">
            <strong>Erreur :</strong> {{ context.decode_error }}
        </div>
        {% endif %}
    </section>
{% endif %}

<!-- Section FAQ pour le SEO -->
<section aria-labelledby="faq-heading" class="faq-section">
    <h2 id="faq-heading">FAQ Base64 - Encodages Support√©s</h2>

    <article itemscope itemtype="https://schema.org/Question">
        <h3 itemprop="name">Qu'est-ce que l'auto-d√©tection d'encodage ?</h3>
        <div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer">
            <p itemprop="text">L'auto-d√©tection analyse automatiquement votre texte Base64 pour identifier l'encodage original utilis√©. Cette fonctionnalit√© utilise des algorithmes avanc√©s pour d√©terminer l'encodage le plus probable avec un niveau de confiance √©lev√©.</p>
        </div>
    </article>

    <article itemscope itemtype="https://schema.org/Question">
        <h3 itemprop="name">Quels encodages sont support√©s ?</h3>
        <div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer">
            <p itemprop="text">Notre outil supporte plus de 30 encodages diff√©rents incluant UTF-8, ASCII, Latin-1, Windows-1252, UTF-16, ainsi que des encodages sp√©cifiques aux langues comme le Japonais (Shift JIS, EUC-JP), le Chinois (GB2312, Big5), le Russe (KOI8-R), et bien d'autres.</p>
        </div>
    </article>

    <article itemscope itemtype="https://schema.org/Question">
        <h3 itemprop="name">Quand utiliser l'auto-d√©tection ?</h3>
        <div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer">
            <p itemprop="text">Utilisez l'auto-d√©tection quand vous ne connaissez pas l'encodage original du texte Base64. C'est particuli√®rement utile pour d√©coder des donn√©es provenant de sources inconnues ou de syst√®mes h√©rit√©s.</p>
        </div>
    </article>
</section>
{% endblock %}
